---
name: openspec-ff-change
description: OpenSpecアーティファクト作成を早送り。ユーザーが各アーティファクトを1つずつ進めることなく、実装に必要なすべてのアーティファクトを素早く作成したい場合に使用。
license: MIT
compatibility: openspec CLIが必要。
metadata:
  author: openspec
  version: "1.0"
  generatedBy: "1.0.2"
---

アーティファクト作成を早送り - 実装を開始するために必要なすべてを一度に生成します。

**入力**: ユーザーのリクエストには変更名（ケバブケース）または構築したいものの説明が含まれるべき。

**手順**

1. **明確な入力が提供されていない場合、何を構築したいか尋ねる**

   **AskUserQuestionツール**（オープンエンド、プリセットオプションなし）を使用して尋ねる：
   > 「どの変更に取り組みたいですか？構築または修正したいものを説明してください。」

   説明からケバブケース名を導出（例：「add user authentication」→ `add-user-auth`）。

   **重要**: ユーザーが何を構築したいか理解せずに進めない。

2. **変更ディレクトリを作成**
   ```bash
   openspec new change "<name>"
   ```
   これにより`openspec/changes/<name>/`にスキャフォールドされた変更が作成される。

3. **アーティファクトのビルド順序を取得**
   ```bash
   openspec status --change "<name>" --json
   ```
   JSONをパースして取得：
   - `applyRequires`: 実装前に必要なアーティファクトIDの配列（例：`["tasks"]`）
   - `artifacts`: すべてのアーティファクトのリストとその状態と依存関係

4. **apply準備完了までアーティファクトを順番に作成**

   **TodoWriteツール**を使用してアーティファクトの進捗を追跡。

   依存関係順でアーティファクトをループ（保留中の依存関係がないアーティファクトを最初に）：

   a. **`ready`（依存関係が満たされている）各アーティファクトについて**：
      - 指示を取得：
        ```bash
        openspec instructions <artifact-id> --change "<name>" --json
        ```
      - instructions JSONに含まれるもの：
        - `context`: プロジェクトの背景（あなたへの制約 - 出力に含めない）
        - `rules`: アーティファクト固有のルール（あなたへの制約 - 出力に含めない）
        - `template`: 出力ファイルに使用する構造
        - `instruction`: このアーティファクトタイプのスキーマ固有のガイダンス
        - `outputPath`: アーティファクトを書き込む場所
        - `dependencies`: コンテキストのために読む完了済みアーティファクト
      - コンテキストのために完了済みの依存ファイルを読む
      - `template`を構造として使用してアーティファクトファイルを作成
      - `context`と`rules`を制約として適用 - ただしファイルにはコピーしない
      - 簡潔な進捗を表示：「✓ <artifact-id>を作成」

   b. **すべての`applyRequires`アーティファクトが完了するまで続行**
      - 各アーティファクト作成後、`openspec status --change "<name>" --json`を再実行
      - `applyRequires`のすべてのアーティファクトIDがartifacts配列で`status: "done"`かどうか確認
      - すべての`applyRequires`アーティファクトが完了したら停止

   c. **アーティファクトがユーザー入力を必要とする場合**（コンテキストが不明確）：
      - **AskUserQuestionツール**を使用して明確化
      - その後作成を続行

5. **最終状態を表示**
   ```bash
   openspec status --change "<name>"
   ```

**出力**

すべてのアーティファクト完了後、要約：
- 変更名と場所
- 作成されたアーティファクトのリストと簡潔な説明
- 準備完了内容：「すべてのアーティファクトが作成されました！実装の準備ができています。」
- プロンプト：「`/opsx:apply`を実行するか、実装を依頼してタスクに取り組み始めてください。」

**アーティファクト作成ガイドライン**

- 各アーティファクトタイプについては`openspec instructions`の`instruction`フィールドに従う
- スキーマが各アーティファクトに含まれるべきものを定義 - それに従う
- 新しいものを作成する前に依存アーティファクトを読んでコンテキストを得る
- `template`を出力ファイルの構造として使用 - そのセクションを埋める
- **重要**: `context`と`rules`は**あなた**への制約であり、ファイルのコンテンツではない
  - `<context>`、`<rules>`、`<project_context>`ブロックをアーティファクトにコピーしない
  - これらは何を書くかをガイドするが、出力に表示されるべきではない

**ガードレール**
- 実装に必要なすべてのアーティファクトを作成（スキーマの`apply.requires`で定義されたもの）
- 新しいものを作成する前に常に依存アーティファクトを読む
- コンテキストが決定的に不明確な場合はユーザーに確認 - ただし勢いを維持するために合理的な決定を優先
- その名前の変更が既に存在する場合、代わりにその変更を続けることを提案
- 次に進む前に各アーティファクトファイルが書き込み後に存在することを確認
