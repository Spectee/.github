---
name: "OPSX: 一括作成"
description: 変更を作成し、実装に必要なすべてのアーティファクトを一度に生成
category: Workflow
tags: [workflow, artifacts, experimental]
---

アーティファクト作成を一括で実行 - 実装開始に必要なすべてを生成します。

**入力**: `/opsx:ff`の後の引数は変更名（ケバブケース）、またはユーザーが構築したい内容の説明です。

**手順**

1. **入力がない場合は、何を構築したいか尋ねる**

   **AskUserQuestionツール**（オープンエンド、プリセットオプションなし）を使用して尋ねます：
   > 「どのような変更を行いたいですか？構築または修正したい内容を説明してください。」

   説明からケバブケース名を導出します（例：「ユーザー認証を追加」→ `add-user-auth`）。

   **重要**: ユーザーが何を構築したいか理解せずに進めないでください。

2. **変更ディレクトリを作成**
   ```bash
   openspec new change "<name>"
   ```
   `openspec/changes/<name>/`にスキャフォールドされた変更が作成されます。

3. **アーティファクトのビルド順序を取得**
   ```bash
   openspec status --change "<name>" --json
   ```
   JSONをパースして取得：
   - `applyRequires`: 実装前に必要なアーティファクトIDの配列（例：`["tasks"]`）
   - `artifacts`: すべてのアーティファクトとその状態・依存関係のリスト

4. **apply準備完了までアーティファクトを順次作成**

   **TodoWriteツール**を使用してアーティファクトの進捗を追跡。

   依存関係順にアーティファクトをループ（未解決の依存関係がないアーティファクトを先に）：

   a. **`ready`（依存関係が満たされている）各アーティファクトに対して**:
      - 指示を取得：
        ```bash
        openspec instructions <artifact-id> --change "<name>" --json
        ```
      - 指示JSONには以下が含まれる：
        - `context`: プロジェクトの背景（あなたへの制約 - 出力に含めない）
        - `rules`: アーティファクト固有のルール（あなたへの制約 - 出力に含めない）
        - `template`: 出力ファイルに使用する構造
        - `instruction`: このアーティファクトタイプのスキーマ固有ガイダンス
        - `outputPath`: アーティファクトを書き込む場所
        - `dependencies`: コンテキストとして読む完了済みアーティファクト
      - コンテキストとして完了した依存ファイルを読む
      - `template`を構造として使用してアーティファクトファイルを作成
      - `context`と`rules`を制約として適用 - ファイルにコピーしない
      - 簡潔に進捗を表示：「✓ <artifact-id> を作成」

   b. **`applyRequires`のすべてのアーティファクトが完了するまで続行**
      - 各アーティファクト作成後、`openspec status --change "<name>" --json`を再実行
      - `applyRequires`のすべてのアーティファクトIDがartifacts配列で`status: "done"`かチェック
      - `applyRequires`のすべてのアーティファクトが完了したら停止

   c. **アーティファクトがユーザー入力を必要とする場合**（コンテキストが不明確）:
      - **AskUserQuestionツール**を使用して明確化
      - その後作成を続行

5. **最終状態を表示**
   ```bash
   openspec status --change "<name>"
   ```

**出力**

すべてのアーティファクト完了後、まとめ：
- 変更名と場所
- 作成されたアーティファクトのリストと簡単な説明
- 準備完了：「すべてのアーティファクトが作成されました！実装の準備ができています。」
- プロンプト：「`/opsx:apply`を実行して実装を開始」

**アーティファクト作成ガイドライン**

- 各アーティファクトタイプの`openspec instructions`からの`instruction`フィールドに従う
- スキーマが各アーティファクトに含めるべき内容を定義 - それに従う
- 新しいアーティファクトを作成する前に依存アーティファクトを読む
- `template`を開始点として使用し、コンテキストに基づいて記入

**ガードレール**
- 実装に必要なすべてのアーティファクトを作成（スキーマの`apply.requires`で定義）
- 新しいアーティファクトを作成する前に必ず依存アーティファクトを読む
- コンテキストが決定的に不明確な場合はユーザーに尋ねる - ただし勢いを維持するため合理的な決定を優先
- その名前の変更が既に存在する場合、続行するか新しいものを作成するか尋ねる
- 次に進む前に各アーティファクトファイルが存在することを確認
